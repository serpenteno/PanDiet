{% extends "base.html" %}
{% load static %}

{% block content %}
                <div class="container-fluid">
                    <h2 class="text-secondary-emphasis mb-1">DietPlan</h2>
                    <h5 class="text-secondary">Today is Monday 16.01</h5>
                </div><!-- Start: DietPlanDisplay -->
                <div class="container border rounded border-2 border-light-subtle my-5 mt-4 mb-4 ps-4 pe-4 pt-3 pb-3" style="background: var(--bs-light-bg-subtle);">
                    <!-- Start: WholeWeek -->
                    <div>
                        <h3 class="fw-semibold text-center text-secondary-emphasis">Week - 1<button class="btn btn-danger pt-1 ms-3 ps-2 pe-2" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor" style="font-size: 16px;">
                                    <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. -->
                                    <path d="M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z"></path>
                                </svg></button></h3><!-- Start: WeekDaysRow -->
                        <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 row-cols-xxl-5 d-flex d-sm-flex d-md-flex d-lg-flex d-xl-flex d-xxl-flex justify-content-center align-items-start justify-content-sm-center align-items-sm-start justify-content-md-center align-items-md-start justify-content-lg-center align-items-lg-start justify-content-xl-center align-items-xl-start justify-content-xxl-center align-items-xxl-start">
                            <div id="meal-schedule">
                                <div class="day-container" id="Monday" data-day-number="1">
                                    <h4>Monday (Day 1)</h4>
                                    <div class="meal-section" data-time="Breakfast">
                                        <h5>Breakfast</h5>
                                        <ul>
                                            <!-- Dynamic data -->
                                        </ul>
                                    </div>
                                    <div class="meal-section" data-time="AM Snack">
                                        <h5>AM Snack</h5>
                                        <ul></ul>
                                    </div>
                                    <div class="meal-section" data-time="Lunch">
                                        <h5>Lunch</h5>
                                        <ul></ul>
                                    </div>
                                    <div class="meal-section" data-time="PM Snack">
                                        <h5>PM Snack</h5>
                                        <ul></ul>
                                    </div>
                                    <div class="meal-section" data-time="Dinner">
                                        <h5>Dinner</h5>
                                        <ul></ul>
                                    </div>
                                </div>
                                <!-- Dynamic days data -->
                            </div>
                        </div><!-- End: WeekDaysRow -->
                    </div><!-- End: WholeWeek -->
                </div><!-- End: DietPlanDisplay -->
                <div class="container">
                    <div class="row">
                        <div class="col"><button class="btn btn-success me-3 mb-3" type="button" style="color: rgb(255,255,255);">Add new meal</button><button class="btn btn-info mb-3 me-3" type="button" style="color: rgb(255,255,255);">Add new week</button></div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="card" style="background: var(--bs-light-bg-subtle);">
                                <div class="card-body">
                                    <h4 class="card-title">Diet plan name</h4>
                                    <div class="row mb-2">
                                        <div class="col"><input type="text" name="name" placeholder="Fill with custom name..."></div>
                                    </div>
                                    <h4 class="card-title">Diet plan description</h4>
                                    <div class="row">
                                        <div class="col"><textarea rows="4" cols="64" name="description" placeholder="Fill with custom description..."></textarea></div>
                                    </div><button class="btn btn-warning" type="button" style="color: rgb(255,255,255);">Save dietplan</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- Start: View Meal Modal -->
                <div class="modal fade" role="dialog" tabindex="-1" id="modal-1">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Meal Adder</h4><button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="meal-form">
                                    <div class="mb-3">
                                        <label class="form-label" for="day-select">Day</label>
                                        <select class="form-select" id="day-select">
                                            <option value="" disabled selected>Wybierz dzień</option>
                                            <option value="1">Monday (Day 1)</option>
                                            <option value="2">Tuesday (Day 2)</option>
                                            <option value="3">Wednesday (Day 3)</option>
                                            <option value="4">Thursday (Day 4)</option>
                                            <option value="5">Friday (Day 5)</option>
                                            <option value="6">Saturday (Day 6)</option>
                                            <option value="7">Sunday (Day 7)</option>
                                            <!-- Dynamic data -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="time-select">Daytime</label>
                                        <select class="form-select" id="time-select">
                                            <option value="" disabled selected>Wybierz porę dnia</option>
                                            <option value="Breakfast">Breakfast</option>
                                            <option value="AM Snack">AM Snack</option>
                                            <option value="Lunch">Lunch</option>
                                            <option value="PM Snack">PM Snack</option>
                                            <option value="Dinner">Dinner</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="meal-select">Meal</label>
                                        <select class="form-select" id="meal-select">
                                            <option value="" disabled selected>Wybierz posiłek</option>
                                            <!-- Dynamic data -->
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer"><button class="btn btn-success" type="button" data-bs-dismiss="modal" style="color: rgb(255,255,255);">Confirm</button><button class="btn btn-danger" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor">
                                        <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. -->
                                        <path d="M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z"></path>
                                    </svg></button><button class="btn btn-light" type="button" data-bs-dismiss="modal">Close</button></div>
                        </div>
                    </div>
                </div><!-- End: View Meal Modal -->
{% endblock %}
{% block extra_js %}
<script>
    $(document).ready(function() {
        const planId = 7; // static id=7 for debugging
        fetchDietPlan(planId);

        // 1) Initialize Select2 for meals
        $('#mealsSelect').select2({
        placeholder: 'Search or pick meals...',
        dropdownParent: $('#modal-1'), // dropdown on top of modal-1
        minimumInputLength: 0,
        ajax: {
            url: '/api/meals/',
            dataType: 'json',
            delay: 250,
            data: function (params) {
            return {
                search: params.term || '',
                page: params.page || 1
            };
            },
            processResults: function (data, params) {
            // data => { count, next, previous, results: [...] } (standard DRF)
            const results = data.results.map(item => ({
                id: item.id.toString(),
                text: item.name,
                day_number: item.day_number,
                day_time: item.day_time
            }));
            let more = false;
            if (data.next) {
                more = true;
            }
            return {
                results: results,
                pagination: {
                more: more
                }
            };
            }
        }
        });
    });
</script>
{% endblock %}